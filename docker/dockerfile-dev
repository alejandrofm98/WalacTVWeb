# Etapa Ãºnica: Dev Angular
FROM node:20-alpine

WORKDIR /app

# Copiar archivos de dependencias
COPY package*.json ./

# Instalar dependencias
RUN npm ci --legacy-peer-deps

# Copiar todo el cÃ³digo fuente
COPY . .

# ARGs que vienen de Dokploy o docker-compose
ARG APP_NAME
ARG IPTV_API_URL

# ðŸ”§ Crear environment.ts dinÃ¡micamente para desarrollo
RUN echo "export const environment = { \
  production: false, \
  appName: '${APP_NAME}', \
  iptvApiUrl: '${IPTV_API_URL}' \
};" > src/environments/environment.ts

# Exponer el puerto de ng serve
EXPOSE 4200

# CMD para desarrollo: ng serve en todas las interfaces
CMD ["npm", "run", "start", "--", "--host", "0.0.0.0", "--port", "4200"]
